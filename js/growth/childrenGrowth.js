function init(){$("#logo .curClass").click(function(){growthStudent_port(user.classId)}),newInit(),listInit(),$("[data-click=scroll-top]").click(function(t){t.preventDefault(),$("html, body").animate({scrollTop:$("body").offset().top},500)}),$(document).scroll(function(){var t=$(document).scrollTop();t>=800?$("[data-click=scroll-top]").addClass("in"):$("[data-click=scroll-top]").removeClass("in")}),$(window).resize(function(){windowResize()}),carousel()}function newInit(){loadFiles(),growthBanner_port(user.classId),chooseNiceScroll("#upload"),chooseNiceScroll("#whoBox"),$("#newBtn,#newText").click(function(){$("#editor").toggleClass("active").find("#input >textarea").val("")}),$(".newTopBtn").click(function(){$(this).toggleClass("active"),$(this).find("span").text($(this).hasClass("active")?"开":"关")}),$("#editor >#input >textarea").keyup(function(){$("#editor .newNumBtn >span").text($(this).val().length),$(this).val().length>1e3?$(this).addClass("more"):$(this).removeClass("more")}),$("#editor .newPicBtn").click(function(){$("#modal-picture").modal("show")}),$("#editor .newWhoBtn").click(function(){$("#modal-who").modal("show")}),$(".picMain >ul").on("click","li.addBtn01",function(){$("#addBtn").click()}),$(".picMain >ul").on("click","li.loadImg",function(){$(this).toggleClass("active"),isMaxNum()}),$("#picListUl").on("click",".deleteBtn",function(t){t.stopPropagation(),$(this).parents("li").remove()}),$("#editor .newLabelBtn").click(function(){$("#modal-label").modal("show")}),$("#labelLib").on("click","span",function(){$(this).addClass("active").siblings().removeClass("active"),$(".newLabel").empty().text("标签：").append($(this).clone()).find("span").append('<span class="deleteBtn"></span>'),$("#modal-label").modal("hide")}),$(".newLabel").on("click",".deleteBtn",function(){$(".newLabel").empty()}),$("#picBtn").click(function(){var t=$("#picTabContent .picMain ul.picBody >li.active");if(t.length>40)toastTip("提示","支持最大张数为40张",2e3);else{var e=[];if(t.length>0)for(var a=0;a<t.length;a++)e.push(t.eq(a).attr("data-md5"));var i={arr:e,path_img:httpUrl.path_img},s=template("picListUl_script",i);$("#picListUl").empty().append(s).parent("#picList").addClass("active"),$("#modal-picture").modal("hide")}}),$("#modal-who .whoBody").on("click","li",function(){$(this).toggleClass("active")}),$("#whoBtn").click(function(){$(".newWho").empty().text("谁可见：").append($(".whoBody >li.active").clone()),$("#modal-who").modal("hide")}),$(".newWho").on("click","li >.deleteBtn",function(){1==$(".newWho li").length?$(".newWho").empty():$(this).parent("li").remove()}),$("#commentNew").click(function(){if($("#editor >#input >textarea").hasClass("more"))toastTip("提示","最多输入1000字...",2e3);else if($("#editor >#input >textarea").val()||$("#picListUl >li").length>0){for(var t=[],e=0;e<$("#picListUl >li").length;e++)t.push($("#picListUl >li").eq(e).attr("data-pic"));t=distinct(t);var a=[];if(0==$(".newLabel >span").length)a=[];else for(var e=0;e<$(".newLabel >span").length;e++)a.push($(".newLabel >span").eq(e).attr("data-id"));for(var i=[],e=0;e<$(".newWho >li.active").length;e++)i.push($(".newWho >li.active").eq(e).attr("data-studentuuid"));var s;s=$(".newTopBtn").hasClass("active")?"1":"0";var n={childUseruuidList:i,classId:user.classId.toString(),content:$("#input >textarea").val(),labelList:a,pictureList:t,stickyPost:s,video:""};growthAdd_port(n)}else toastTip("提示","文字和图片至少需选择一项",2e3)})}function listInit(){growthLabel_port(),$("#label").on("click","span",function(){$(this).addClass("active").siblings().removeClass("active"),growthList_port(user.classId,0,$("#label >span.active").attr("data-id"),0)}),window.onscroll=function(){getDocumentTop()==getScrollHeight()-getWindowHeight()&&growthList_port(user.classId,$("#list >li:last").attr("data-newidmax")||0,$("#label >span.active").attr("data-id"),1)},$("#list").on("click",".canDelete",function(){var t=confirm("确定删除吗？");1==t&&growthMessageDelete_port(user.classId,$(this).attr("data-messageId"))}),$("#list").on("click",".praiseBtn",function(){growthAddordelete_port(user.classId,$(this).attr("data-messageId"),$(this).attr("data-praiseid"))}),$("#list").on("click",".commentDelete",function(t){t.stopPropagation(),growthCommentDelete_port(user.classId,$(this).attr("data-messageId"),$(this).attr("data-commentId"))}),$("#list").on("click",".commentBtn",function(){$("#list .commentBox[data-messageId="+$(this).attr("data-messageId")+"]").addClass("active").find("textarea").val("").attr("placeholder","评论：").focus(),$("#list .commentBox[data-messageId="+$(this).attr("data-messageId")+"]").find(".comment").attr("data-cuseruuid","")}),$("#list").on("click",".commentListBox >li",function(){1==$(this).find(".commentTip").length&&($(this).parents(".commentList").next(".commentBox").addClass("active").find("textarea").val("").attr("placeholder","回复 "+$(this).attr("data-commentUserName")+":").focus(),$(this).parents(".commentList").next(".commentBox").addClass("active").find(".comment").attr("data-cuseruuid",$(this).attr("data-commentUseruuid")))}),$("#list").on("click",".comment",function(){if($(this).prev("textarea").val()){var t={classId:user.classId,cuseruuid:$(this).attr("data-cuseruuid"),messageId:$(this).attr("data-messageId"),content:$(this).prev("textarea").val()};growthCommentAdd_port(t)}else toastTip("提示","请先填写评论...",2e3)}),$("#list").on("click",".stickyPost >span",function(){growthCancelSticky_port($(this).attr("data-messageid"))}),$("#list").on("click",".fold",function(){$(this).toggleClass("active"),$(this).text($(this).hasClass("active")?"收起":"展开全文"),$(this).prevAll("span").toggleClass("active")}),$("#list").on("click",".twelve",function(){$(this).addClass("hide").parent("li").nextAll(".more").removeClass("hide").parents(".pictureList").next(".foldPic").removeClass("hide")}),$("#list").on("click",".foldPic",function(){$(this).addClass("hide").prev("ul").find(".more").addClass("hide"),$(this).prev("ul").find(".twelve").removeClass("hide")}),$("#list").on("click",".cancelBtn",function(){$(this).parents(".commentBox").removeClass("active")})}function growthAdd_port(t){var e={childUseruuidList:t.childUseruuidList,classId:t.classId,content:t.content,labelList:t.labelList,pictureList:t.pictureList,stickyPost:t.stickyPost,video:t.video},a={params:JSON.stringify(e),loginId:httpUrl.loginId};initAjax(httpUrl.growthAdd,a,growthAdd_callback)}function growthAdd_callback(t){200==t.code&&($("#picListUl,.newLabel,.newWho").empty(),$(".newNumBtn >span").text("0"),$("#newBtn").click(),growthList_port(user.classId,0,$("#label >span.active").attr("data-id"),0))}function growthBanner_port(){var t={},e={params:JSON.stringify(t),loginId:httpUrl.loginId};initAjax(httpUrl.growthBanner,e,growthBanner_callback)}function growthBanner_callback(t){if(200==t.code){var e={arr:JSON.parse(t.data),path_img:httpUrl.path_img},a=template("banner_script",e);$(".carousel-inner").empty().append(a),growthStudent_port(user.classId),windowResize()}}function growthLabel_port(){var t={},e={params:JSON.stringify(t),loginId:httpUrl.loginId};initAjax(httpUrl.growthLabel,e,growthLabel_callback)}function growthLabel_callback(t){if(200==t.code){var e={arr:JSON.parse(t.data)},a=template("lable_script",e);$("#label,#labelLib").empty().append(a),growthList_port(user.classId,0,$("#label >span.active").attr("data-id"),0)}}function growthMessageDelete_port(t,e){var a={classId:t,messageId:e},i={params:JSON.stringify(a),loginId:httpUrl.loginId};initAjax(httpUrl.growthMessageDelete,i,growthMessageDelete_callback,e)}function growthMessageDelete_callback(t,e){200==t.code&&$("#list >li[data-id="+e+"]").remove()}function growthAddordelete_port(t,e,a){var i={classId:t,messageId:e,praiseId:a},s={params:JSON.stringify(i),loginId:httpUrl.loginId};initAjax(httpUrl.growthAddordelete,s,growthAddordelete_callback,i)}function growthAddordelete_callback(t,e){if(200==t.code){if("点赞成功"==t.info){var a=JSON.parse(t.data);if($("#list .praiseBtn[data-messageId="+e.messageId+"]").addClass("hover").text("取消赞").attr("data-praiseid",a.id),0==$(".praiseList[data-messageId="+e.messageId+"]").children().length){var i=template("praise_script",a);$(".praiseList[data-messageId="+e.messageId+"]").append(i)}else $(".praiseList[data-messageId="+e.messageId+"] >.praiseListBox").append("<span data-praiseid="+a.id+' class="praiseUserName">,'+a.praiseUserName+"</span>")}"取消赞成功"==t.info&&($("#list .praiseBtn[data-messageId="+e.messageId+"]").removeClass("hover").text("赞").attr("data-praiseid",0),1==$(".praiseList[data-messageId="+e.messageId+"] >.praiseListBox >.praiseUserName").length?$(".praiseList[data-messageId="+e.messageId+"]").empty():$(".praiseList[data-messageId="+e.messageId+"] >.praiseListBox >.praiseUserName[data-praiseid="+e.praiseId+"]").remove())}}function growthCommentDelete_port(t,e,a){var i={classId:t,messageId:e,commentId:a},s={params:JSON.stringify(i),loginId:httpUrl.loginId};initAjax(httpUrl.growthCommentDelete,s,growthCommentDelete_callback,i)}function growthCommentDelete_callback(t,e){200==t.code&&"删除成功"==t.info&&(1==$("#list .commentList[data-messageid="+e.messageId+"] li").length?$("#list .commentList[data-messageid="+e.messageId+"]").empty():$("#list .commentList[data-messageid="+e.messageId+"] li[data-commentid="+e.commentId+"]").remove())}function growthCommentAdd_port(t){var e={classId:t.classId,cuseruuid:t.cuseruuid,messageId:t.messageId,content:t.content},a={params:JSON.stringify(e),loginId:httpUrl.loginId};initAjax(httpUrl.growthCommentAdd,a,growthCommentAdd_callback,e)}function growthCommentAdd_callback(t,e){if(200==t.code){$(".commentBox[data-messageId="+e.messageId+"]").removeClass("active").find("textarea").text("");var a=JSON.parse(t.data);if(a.createUseruuid=$(".commentList[data-messageId="+e.messageId+"]").attr("data-createUseruuid"),a.messageId=e.messageId,a.useruuid=user.useruuid,$(".commentList[data-messageId="+e.messageId+"]").find("li").length>0){a.empty=1;var i=template("comment_script",a);$(".commentList[data-messageId="+e.messageId+"] >ul").append(i),$(".commentBox[data-messageId="+e.messageId+"] textarea").val("")}else{a.empty=0;var i=template("comment_script",a);$(".commentList[data-messageId="+e.messageId+"]").append(i),$(".commentBox[data-messageId="+e.messageId+"] textarea").val("")}}}function growthList_port(t,e,a,i){var s={classId:t,idMax:e,labelId:a},n={params:JSON.stringify(s),loginId:httpUrl.loginId};initAjax(httpUrl.growthList,n,growthList_callback,i)}function growthList_callback(t,e){if(200==t.code){for(var a={arr:JSON.parse(t.data),path_img:httpUrl.path_img,useruuid:user.useruuid},i=0;i<a.arr.length;i++)a.arr[i].createTime=new Date(1e3*a.arr[i].createTime).Format("yyyy年MM月dd日 hh:mm"),a.arr[i].content.length>210&&(a.arr[i].content01=a.arr[i].content.slice(209),a.arr[i].content=a.arr[i].content.slice(0,209)),a.arr[i].pictureList.length>12;var s=template("list_script",a);0==e?$("#list").empty().append(s):$("#list").append(s)}else console.log(t.info)}function growthStudent_port(t){var e={classId:t},a={params:JSON.stringify(e),loginId:httpUrl.loginId};initAjax(httpUrl.growthStudent,a,growthStudent_callback)}function growthStudent_callback(t){if(t.code=200){var e={arr:JSON.parse(t.data),path_img:httpUrl.path_img},a=template("who_script",e);$("#modal-who .whoBody").append(a)}}function growthCancelSticky_port(t){var e={messageId:t},a={params:JSON.stringify(e),loginId:httpUrl.loginId};initAjax(httpUrl.growthCancelSticky,a,growthCancelSticky_callback)}function growthCancelSticky_callback(t){(t.code=200)&&growthList_port(user.classId,0,$("#label >span.active").attr("data-id"),0)}function getDocumentTop(){var t=0,e=0,a=0;return document.body&&(e=document.body.scrollTop),document.documentElement&&(a=document.documentElement.scrollTop),t=e-a>0?e:a}function getWindowHeight(){var t=0;return t="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}function getScrollHeight(){var t=0,e=0,a=0;return document.body&&(e=document.body.scrollHeight),document.documentElement&&(a=document.documentElement.scrollHeight),t=e-a>0?e:a}function chooseNiceScroll(t,e){$(t).niceScroll({cursorcolor:e||"#ccc",cursoropacitymax:1,touchbehavior:!1,cursorwidth:"5px",cursorborder:"0",cursorborderradius:"5px",autohidemode:!1})}function toastTip(t,e,a){$.toast({heading:t,text:e,showHideTransition:"slide",icon:"success",hideAfter:a||1500,loaderBg:"#13b5dd",position:"bottom-right"})}function loadFiles(){Dropzone.options.myAwesomeDropzone=!1,Dropzone.autoDiscover=!1;var t=new Dropzone("#addBtn",{url:httpUrl.picUrl,paramName:"mbFile",maxFilesize:50,addRemoveLinks:!0,acceptedFiles:"image/*"});t.on("success",function(t,e){if(void 0==e.uploadFileMd5)return void alert("没有上传成功,请重试");var a={md5:e.uploadFileMd5,path_img:httpUrl.path_img},i=template("picMain01_script",a);$("#upload ul.picBody").append(i),$("#addBtn").parent(".uploadBg").addClass("hide").find("#addBtn >div").remove(),$("#upload .addBtn01").removeClass("hide"),isMaxNum()}),t.on("error",function(t,e){alert("没有上传成功,请重试:"+e),this.removeFile(t)})}function isMaxNum(){$(".maxNum >span").text($("#upload .picBody >li.active").length),$("#upload .picBody >li.active").length>40?$(".maxNum >span").addClass("active"):$(".maxNum >span").removeClass("active")}function carousel(){$("#list").on("click",".pictureList >li > a.pic",function(){$(".deleteBtn01").addClass("hide");for(var t=[],e=$(this).attr("data-pic"),a=0;a<$(this).parents(".pictureList").find("li").length;a++)t.push($(this).parents(".pictureList").find("li").eq(a).attr("data-pic"));console.log(t);var i=httpUrl.path_img+$(this).attr("data-pic")+"&minpic=0";$("#carousel_img").empty().append("<img src="+i+" data-curpic="+e+" />"),$("#carousel_img").prev(".prevBtn").attr("data-arr",JSON.stringify(t)).removeClass("hide"),$("#carousel_img").next(".nextBtn").attr("data-arr",JSON.stringify(t)).removeClass("hide"),0==t.indexOf(e)&&$("#carousel_img").prev(".prevBtn").addClass("hide"),t.indexOf(e)+1==t.length&&$("#carousel_img").next(".nextBtn").addClass("hide")}),$("#picListUl").on("click","li > a.pic",function(){$(".deleteBtn01").removeClass("hide");for(var t=[],e=$(this).attr("data-pic"),a=0;a<$(this).parents("#picListUl").find("li").length;a++)t.push($(this).parents("#picListUl").find("li").eq(a).attr("data-pic"));var i=httpUrl.path_img+$(this).attr("data-pic")+"&minpic=0";$("#carousel_img").empty().append("<img src="+i+" data-curpic="+e+" />"),$("#carousel_img").prev(".prevBtn").attr("data-arr",JSON.stringify(t)).removeClass("hide"),$("#carousel_img").next(".nextBtn").attr("data-arr",JSON.stringify(t)).removeClass("hide"),0==t.indexOf(e)&&$("#carousel_img").prev(".prevBtn").addClass("hide"),t.indexOf(e)+1==t.length&&$("#carousel_img").next(".nextBtn").addClass("hide")}),$("#modal-dialog-img .deleteBtn01").click(function(){var t=$("#carousel_img").find("img").attr("data-curpic"),e=JSON.parse($("#modal-dialog-img .prevBtn").attr("data-arr"));1==e.length?$(this).prev(".closeBtn01").click():$("#carousel_img").empty().append(e.indexOf(t)+1!=e.length?"<img src="+httpUrl.path_img+e[e.indexOf(t)+1]+"&minpic=0 data-curpic="+e[e.indexOf(t)+1]+" />":"<img src="+httpUrl.path_img+e[e.indexOf(t)-1]+"&minpic=0 data-curpic="+e[e.indexOf(t)-1]+" />"),e.splice(e.indexOf(t),1),$("#modal-dialog-img .nextBtn,#modal-dialog-img .prevBtn").attr("data-arr",JSON.stringify(e));var a=$("#carousel_img").find("img").attr("data-curpic");0==e.indexOf(a)&&$("#carousel_img").prev(".prevBtn").addClass("hide"),e.indexOf(a)+1==e.length&&$("#carousel_img").next(".nextBtn").addClass("hide"),$("#picListUl >li[data-pic="+t+"]").remove()}),$("#modal-dialog-img .prevBtn").click(function(){var t=$(this).next("#carousel_img").find("img").attr("data-curpic"),e=JSON.parse($(this).attr("data-arr"));if(e.indexOf(t)>0){var a=e[e.indexOf(t)-1];e.indexOf(t)-1==0?($("#carousel_img").prev(".prevBtn").addClass("hide"),$("#carousel_img >img").attr("data-curpic",a).attr("src",httpUrl.path_img+a+"&minpic=0")):$("#carousel_img >img").attr("data-curpic",a).attr("src",httpUrl.path_img+a+"&minpic=0"),e.indexOf(t)+1==e.length&&$("#carousel_img").next(".nextBtn").removeClass("hide")}}),$(window).keyup(function(t){$("#modal-dialog-img").hasClass("in")&&(37!=t.which||$("#modal-dialog-img .prevBtn").hasClass("hide")||$("#modal-dialog-img .prevBtn").click(),39!=t.which||$("#modal-dialog-img .nextBtn").hasClass("hide")||$("#modal-dialog-img .nextBtn").click())}),$("#modal-dialog-img .nextBtn").click(function(){var t=$(this).prev("#carousel_img").find("img").attr("data-curpic"),e=JSON.parse($(this).attr("data-arr"));if(e.indexOf(t)+1<e.length){var a=e[e.indexOf(t)+1];e.indexOf(t)+2==e.length?($("#carousel_img").next(".nextBtn").addClass("hide"),$("#carousel_img >img").attr("data-curpic",a).attr("src",httpUrl.path_img+a+"&minpic=0")):$("#carousel_img >img").attr("data-curpic",a).attr("src",httpUrl.path_img+a+"&minpic=0")}0==e.indexOf(t)&&$("#carousel_img").prev(".prevBtn").removeClass("hide")})}function distinct(t){var e={},a=0,i=0;if(Array.isArray(t)&&t.length>0){for(i=t.length,a=0;i>a;a+=1)e[t[a]]=t[a];return Object.keys(e)}return[]}function windowResize(){var t=document.body.clientWidth,e=800*t/1920;e>500?$(".carousel-inner > .item img").css("height",e):$(".carousel-inner > .item img").css("height",500)}$(function(){init()});